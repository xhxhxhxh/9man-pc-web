(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{126:function(e,t,a){"use strict";a.d(t,"a",(function(){return s})),a.d(t,"b",(function(){return i}));var s=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"teacherVideo-container"},[s("div",{staticClass:"video-area"},[s("video",{ref:"video",attrs:{autoplay:"",loop:"",type:"video/mp4"}}),e._v(" "),s("span",{staticClass:"name"},[e._v(e._s(e.teacherName))])]),e._v(" "),s("div",{staticClass:"status-area"},[s("div",{staticClass:"status-bar"},[s("div",{staticClass:"netStatus"},[s("NetStatus"),e._v(" "),s("span",[e._v("网络状态")])],1),e._v(" "),s("div",{staticClass:"mikeStatus"},[s("img",{attrs:{src:a(52),alt:""}}),e._v(" "),s("MikeStatus",{attrs:{openMike:e.mikeStatus,identity:e.identity,rtcRoom:e.rtcRoom,id:e.teacherId}})],1)])])])},i=[];s._withStripped=!0},127:function(e,t,a){"use strict";a.d(t,"a",(function(){return s})),a.d(t,"b",(function(){return i}));var s=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"studentVideo-container"},[s("div",{staticClass:"video-area",attrs:{id:"video"+e.id}},[s("span",{staticClass:"name"},[e._v(e._s(e.studentName))]),e._v(" "),s("video",{directives:[{name:"show",rawName:"v-show",value:!e.showPicture,expression:"!showPicture"}],ref:"video",attrs:{autoplay:"",loop:"",type:"video/*"},domProps:{muted:"self"===e.identity}})]),e._v(" "),s("div",{staticClass:"status-area"},[e.showStudentStatus?s("div",{staticClass:"status-bar"},[s("div",{staticClass:"netStatus"},[s("NetStatus"),e._v(" "),s("span",[e._v("网络状态")])],1),e._v(" "),s("div",{staticClass:"mikeStatus"},[s("img",{attrs:{src:a(52),alt:""}}),e._v(" "),s("MikeStatus",{attrs:{openMike:e.mikeStatus,identity:e.identity,rtcRoom:e.rtcRoom,id:e.id}})],1),e._v(" "),e._m(0)]):e._e()])])},i=[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"star"},[t("img",{attrs:{src:a(67),alt:""}}),this._v(" "),t("span",[this._v("x8")])])}];s._withStripped=!0},128:function(e,t,a){"use strict";a.d(t,"a",(function(){return s})),a.d(t,"b",(function(){return i}));var s=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"studentInfo-container"},[s("div",{staticClass:"student-info"},[s("p",{staticClass:"name"},[e._v(e._s(e.studentName))]),e._v(" "),s("div",{staticClass:"status-bar"},[s("div",{staticClass:"mikeStatus"},[s("img",{attrs:{src:a(52),alt:""}}),e._v(" "),s("MikeStatus",{attrs:{openMike:e.mikeStatus}})],1),e._v(" "),e._m(0)])]),e._v(" "),s("div",{staticClass:"avatar"},[s("div",{directives:[{name:"show",rawName:"v-show",value:e.id===e.studentOnStageId,expression:"id === studentOnStageId"}],staticClass:"onStage"},[s("p",[e._v("上台中")]),e._v(" "),s("p",[e._v("...")])])])])},i=[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"star"},[t("img",{attrs:{src:a(67),alt:""}}),this._v(" "),t("span",[this._v("x8")])])}];s._withStripped=!0},129:function(e,t,a){"use strict";a.d(t,"a",(function(){return s})),a.d(t,"b",(function(){return i}));var s=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"liveBroadcast-student-container"},[s("div",{staticClass:"statusBar"},[s("div",{staticClass:"deviceInfo"},[s("div",{staticClass:"netStatus"},[s("span",[e._v("网络状态:")]),e._v(" "),s("NetStatus")],1),e._v(" "),s("div",{staticClass:"mikeStatus"},[s("span",[e._v("麦克风:")]),e._v(" "),s("MikeStatus",{attrs:{openMike:e.mikeStatus}})],1),e._v(" "),s("div",{staticClass:"speakerStatus"},[s("span",[e._v("扬声器:")]),e._v(" "),s("Speaker")],1)]),e._v(" "),e._m(0),e._v(" "),s("div",{staticClass:"startClass"},[s("span",{staticClass:"time"},[e._v("01:50:30")]),e._v(" "),s("a-button",[e._v("开始上课")]),e._v(" "),s("img",{attrs:{src:a(175),alt:""},on:{click:e.leaveRoom}})],1)]),e._v(" "),s("main",{ref:"main",staticClass:"clearfix"},[s("div",{staticClass:"videoArea"},[s("div",{staticClass:"video-teacher"},[s("TeacherVideo",{directives:[{name:"show",rawName:"v-show",value:!e.studentOnStage,expression:"!studentOnStage"}],class:{studentOnStageTypeIsBig:e.studentOnStageTypeIsBig},attrs:{rtcRoom:e.rtcRoom,teacherName:e.teacherName,teacherId:e.teacherId}}),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:e.otherStudentOnStage,expression:"otherStudentOnStage"}],class:{"student-on-stage-box":!0,studentOnStageTypeIsBig:e.studentOnStageTypeIsBig}},[s("StudentVideo",{attrs:{id:e.studentOnStageId,mode:"others",rtcRoom:e.rtcRoom,studentName:e.studentNameObj[e.studentOnStageId],stream:e.streamObj[e.studentOnStageId],studentVideoScale:e.studentVideoScale}})],1)],1),e._v(" "),s("div",{staticClass:"video-students"},[s("StudentVideo",{attrs:{id:e.studentId,studentVideoScale:e.studentVideoScale,studentName:e.studentName,mode:"self",showPicture:e.showPicture,showStudentStatus:!0}})],1)]),e._v(" "),s("div",{ref:"playArea",staticClass:"playArea"},[s("div",{directives:[{name:"show",rawName:"v-show",value:"picture"===e.mode,expression:"mode === 'picture'"}],ref:"editArea",attrs:{id:"tui-image-editor"}}),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:!e.controlStudentOperate,expression:"!controlStudentOperate"}],staticClass:"wrapper"}),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:"animate"===e.mode,expression:"mode === 'animate'"}],ref:"animateArea",staticClass:"animate-area"},[s("iframe",{ref:"iframe",attrs:{src:e.iframeSrc,allow:"autoplay"}})]),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:"video"===e.mode,expression:"mode === 'video'"}],ref:"video-area",staticClass:"video-area"},[s("video",{ref:"video-play",attrs:{src:"",preload:"auto"},on:{ended:e.videoEnded}})]),e._v(" "),s("transition",{attrs:{name:"fade-picture"}},[s("div",{directives:[{name:"show",rawName:"v-show",value:e.showPicture,expression:"showPicture"}],staticClass:"picture-covered-container"},[s("div",{staticClass:"picture-covered",style:{width:e.pictureCoveredWidth+"px"}},[s("div",{staticClass:"picture-covered-box",style:{width:.32*e.playAreaWidth+"px"}},[s("StudentVideo",{attrs:{id:e.studentId,mode:"self",rtcRoom:e.rtcRoom,studentName:e.studentName,studentVideoScale:1.17,showStudentStatus:e.hideStudentStatus}})],1),e._v(" "),e._l(e.peerIdList,(function(t){return s("div",{key:t,staticClass:"picture-covered-box",style:{width:.32*e.playAreaWidth+"px"}},[s("StudentVideo",{attrs:{id:t,mode:"others",rtcRoom:e.rtcRoom,studentName:e.studentNameObj[t],stream:e.streamObj[t],studentVideoScale:1.17,showStudentStatus:e.hideStudentStatus}})],1)}))],2)])]),e._v(" "),s("div",{staticClass:"operate"},[s("div",{staticClass:"mode-picture"},[s("div",{staticClass:"draw-operate"},[s("div",{class:{pencil:!0,selected:"LINE_DRAWING"===e.shape||"FREE_DRAWING"===e.shape},on:{mouseenter:function(t){e.showPencilItem=!0},mouseleave:function(t){e.showPencilItem=!1},click:function(){"FREE_DRAWING"===e.shape?e.stopDrawing():e.shape="FREE_DRAWING",e.drawByShape(),e.trigger(e.shape)}}},[s("div",{directives:[{name:"show",rawName:"v-show",value:e.showPencilItem,expression:"showPencilItem"}],staticClass:"pencil-item",on:{click:function(e){e.stopPropagation()}}},[s("div",{staticClass:"color-item"},e._l(e.colorList,(function(t,a){return s("span",{key:a,class:{selected:e.strokeColor===t},style:{backgroundColor:t,borderColor:t},on:{mousedown:function(a){a.stopPropagation(),e.strokeColor=t}}})})),0),e._v(" "),s("div",{staticClass:"strokeWidth-item"},[s("span",{class:{selected:11===e.strokeWidth},on:{mousedown:function(t){t.stopPropagation(),e.strokeWidth=11}}}),e._v(" "),s("span",{class:{selected:16===e.strokeWidth},on:{mousedown:function(t){t.stopPropagation(),e.strokeWidth=16}}}),e._v(" "),s("span",{class:{selected:26===e.strokeWidth},on:{mousedown:function(t){t.stopPropagation(),e.strokeWidth=26}}})])])]),e._v(" "),s("div",{class:{shape:!0,selected:"SHAPE"===e.shape},on:{mouseenter:function(t){e.showShapeItem=!0},mouseleave:function(t){e.showShapeItem=!1},click:function(){"SHAPE"===e.shape?e.stopDrawing():e.shape="SHAPE",e.drawingShape="rect",e.fill=!1,e.drawByShape(),e.trigger(e.shape)}}},[s("div",{directives:[{name:"show",rawName:"v-show",value:e.showShapeItem,expression:"showShapeItem"}],staticClass:"shape-item"},[s("span",{class:{rect:!0,selected:"rect"===e.drawingShape&&!e.fill&&"SHAPE"===e.shape},on:{click:function(t){return t.stopPropagation(),"SHAPE"!==e.shape||"rect"!==e.drawingShape||e.fill?e.shape="SHAPE":e.stopDrawing(),e.drawingShape="rect",e.fill=!1,e.drawByShape(),void e.trigger(e.shape)}}}),e._v(" "),s("span",{class:{circle:!0,selected:"circle"===e.drawingShape&&!e.fill&&"SHAPE"===e.shape},on:{click:function(t){return t.stopPropagation(),"SHAPE"!==e.shape||"circle"!==e.drawingShape||e.fill?e.shape="SHAPE":e.stopDrawing(),e.drawingShape="circle",e.fill=!1,e.drawByShape(),void e.trigger(e.shape)}}}),e._v(" "),s("span",{staticClass:"line"}),e._v(" "),s("span",{class:{fillRect:!0,selected:"rect"===e.drawingShape&&e.fill&&"SHAPE"===e.shape},on:{click:function(t){return t.stopPropagation(),"SHAPE"===e.shape&&"rect"===e.drawingShape&&e.fill?e.stopDrawing():e.shape="SHAPE",e.drawingShape="rect",e.fill=!0,e.drawByShape(),void e.trigger(e.shape)}}}),e._v(" "),s("span",{class:{fillCircle:!0,selected:"circle"===e.drawingShape&&e.fill&&"SHAPE"===e.shape},on:{click:function(t){return t.stopPropagation(),"SHAPE"===e.shape&&"circle"===e.drawingShape&&e.fill?e.stopDrawing():e.shape="SHAPE",e.drawingShape="circle",e.fill=!0,e.drawByShape(),void e.trigger(e.shape)}}})])]),e._v(" "),s("div",{class:{text:!0,selected:"TEXT"===e.shape},on:{click:function(){"TEXT"===e.shape?e.stopDrawing():e.shape="TEXT",e.drawByShape(),e.trigger(e.shape)}}}),e._v(" "),s("div",{staticClass:"line"}),e._v(" "),s("div",{staticClass:"eraser",on:{click:e.eraser}}),e._v(" "),s("div",{staticClass:"delete",on:{click:e.clearAll}}),e._v(" "),s("div",{staticClass:"back",on:{click:e.undo}})])]),e._v(" "),s("div",{staticClass:"student-list"},e._l(e.peerIdList,(function(t){return s("StudentInfo",{key:t,attrs:{studentName:e.studentNameObj[t],id:t,studentOnStageId:e.studentOnStageId}})})),1)])],1)])])},i=[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"className"},[t("span",[this._v(" L1  0730班  某某课")])])}];s._withStripped=!0},238:function(e,t){},239:function(e,t){},302:function(e,t,a){"use strict";a.r(t);var s=a(73),i=a.n(s);for(var n in s)"default"!==n&&function(e){a.d(t,e,(function(){return s[e]}))}(n);var o=a(126),r=a(6),d=!1;var c=function(e){d||a(303)},u=Object(r.a)(i.a,o.a,o.b,!1,c,"data-v-95fea93c",null);u.options.__file="src\\components\\liveBroadcast\\TeacherVideoForStudent.vue",t.default=u.exports},303:function(e,t){},304:function(e,t,a){"use strict";a.r(t);var s=a(74),i=a.n(s);for(var n in s)"default"!==n&&function(e){a.d(t,e,(function(){return s[e]}))}(n);var o=a(127),r=a(6),d=!1;var c=function(e){d||a(305)},u=Object(r.a)(i.a,o.a,o.b,!1,c,"data-v-195fbc69",null);u.options.__file="src\\components\\liveBroadcast\\StudentVideoForStudent.vue",t.default=u.exports},305:function(e,t){},306:function(e,t,a){"use strict";a.r(t);var s=a(75),i=a.n(s);for(var n in s)"default"!==n&&function(e){a.d(t,e,(function(){return s[e]}))}(n);var o=a(128),r=a(6),d=!1;var c=function(e){d||a(307)},u=Object(r.a)(i.a,o.a,o.b,!1,c,"data-v-432752fc",null);u.options.__file="src\\components\\liveBroadcast\\StudentInfo.vue",t.default=u.exports},307:function(e,t){},441:function(e,t,a){"use strict";a.r(t);var s=a(69),i=a.n(s);for(var n in s)"default"!==n&&function(e){a.d(t,e,(function(){return s[e]}))}(n);var o=a(129),r=a(6),d=!1;var c=function(e){d||a(238)},u=Object(r.a)(i.a,o.a,o.b,!1,c,null,null);u.options.__file="src\\views\\liveBroadcast\\liveBroadcastForStudent-v2.vue",t.default=u.exports},69:function(e,t,a){Object.defineProperty(t,"__esModule",{value:!0});var s=h(a(55));a(239);var i=h(a(148)),n=h(a(103)),o=h(a(44)),r=h(a(35)),d=h(a(163)),c=h(a(302)),u=h(a(304)),l=h(a(306));function h(e){return e&&e.__esModule?e:{default:e}}var v=a(111),p={"menu.normalIcon.path":"/svg/icon-d.svg","menu.activeIcon.path":"/svg/icon-b.svg","menu.disabledIcon.path":"/svg/icon-a.svg","menu.hoverIcon.path":"/svg/icon-c.svg","submenu.normalIcon.path":"/svg/icon-d.svg","submenu.activeIcon.path":"/svg/icon-b.svg"};t.default={name:"LiveBroadcast",data:function(){return{shape:"NORMAL",imageEditor:null,showPencilItem:!1,showShapeItem:!1,showStrokeWide:!1,showColorItem:!1,showTextItem:!1,drawingShape:"",fill:!1,strokeWidth:11,strokeColor:"#2E3E50",wideMax:30,textSize:20,colorList:["#E74C3C","#E67E22","#F1C40F","#2ECC71","#29b6f6","#2E3E50"],studentId:"",studentName:"",teacherId:"",teacherName:"",peerIdList:[],rtcRoom:null,studentNameObj:{},streamObj:{},studentOnStageId:"",roomId:"",studentOnStageName:"",otherStudentOnStage:!1,studentOnStageTypeIsBig:!1,iframeSrc:"",showPicture:!1,controlStudentOperate:!1,wrapperZIndex:99,playAreaWidth:1152,mode:"animate",mikeStatus:!0,showStudentStatus:!0,hideStudentStatus:!1,studentVideoScale:1,studentOnStage:!1,coursewareResource:[],resourceIndex:0}},components:{NetStatus:o.default,MikeStatus:r.default,Speaker:d.default,TeacherVideo:c.default,StudentVideo:u.default,StudentInfo:l.default},watch:{strokeWidth:function(e){this.imageEditor.stopDrawingMode(),this.drawByShape();var t={type:"setStrokeWidth",strokeWidth:e};this.sendDrawData(t)},strokeColor:function(e){this.imageEditor.stopDrawingMode(),this.drawByShape();var t={type:"setStrokeColor",strokeColor:e};this.sendDrawData(t)},fill:function(e){this.imageEditor.stopDrawingMode(),this.drawByShape();var t={type:"setFill",fill:e};this.sendDrawData(t)}},computed:{pictureCoveredWidth:function(){var e=.32*this.playAreaWidth,t=this.peerIdList.length;return 0===t?e:1===t?2*e:3*e}},created:function(){this.init()},mounted:function(){this.getCoursewareInfo(this.$route.params.coursewareId),this.paint(),this.getDrawData()},methods:{init:function(){var e=this,t=n.default.getInstance(),a=this.$route.params.roomId,s=this.$route.params.studentId,i={name:this.$route.params.name,headUrl:"",role:2};this.studentId=s,this.roomId=a;var o=this.teacherId=this.$route.params.teacherId;this.studentName=i.name,t.joinRoom("www.9mankid.com",3210,a,s,i),this.rtcRoom=t,t.on("message-notify-receive",(function(t,a){if("synchronize"===a.type){var s=a.values;for(var i in s)e[i]=s[i];e.drawByShape(),e.changeAnimate(!0)}else if("controlStudentOperate"===a.type){a.data.peerId===e.studentId?e.controlStudentOperate=!0:(e.controlStudentOperate=!1,e.wrapperZIndex=99)}})),t.on("user-joined",(function(a){if(console.log("用户进入："+a),a!==s&&a!==o||(t.getAllRoomUser().forEach((function(t){var a=t._peerId;a!==o&&a!==e.studentId&&(e.studentNameObj[a]=t.name,e.streamObj[a]=null,e.peerIdList.push(a)),a===o&&(e.teacherName=t.name)})),e.$nextTick((function(){this.pageMounted()}))),!e.peerIdList.includes(a)&&a!==o&&a!==e.studentId){var i=t.getRoomUser(a);e.studentNameObj[a]=i.name,e.peerIdList.push(a)}})),t.on("user-peer-connected",(function(a){console.log("用户连接："+a),a!==e.teacherId&&t.closeVideo(e.studentId,[e.teacherId])})),t.on("user-leaved",(function(t){console.log("用户离开："+t,e.peerIdList.indexOf(t)),delete e.studentNameObj[t];var a=e.peerIdList.indexOf(t);-1!==a&&e.peerIdList.splice(a,1)})),t.on("ai-action-notify",(function(t,a){console.log("ai-action-notify:"+t,a),a.peerId===e.studentId&&(e.wrapperZIndex=99)})),t.on("media-receive",(function(t,a){console.log("peerId:"+t),t!==e.studentId&&e.$set(e.streamObj,t,a)}))},leaveRoom:function(){var e=this.rtcRoom;this.$confirm({title:"确定要退出房间吗?",content:"",centered:!0,onOk:function(){e.leaveRoom(),window.close()},onCancel:function(){}})},pageMounted:function(){this.rtcRoom.notifyMessage({type:"pageDone"},this.teacherId)},getCoursewareInfo:function(e){var t=this,a={id:e};this.$axios.get(this.$store.state.apiUrl+"/v1/courseware/queryCoursewareDetail",{params:a}).then((function(e){var a=e.data;200===a.code&&(t.coursewareResource=a.data.data.resource,t.changeAnimate(!0))})).catch((function(){}))},paint:function(){var e=this,t=window.innerWidth,a={width:"",height:""};t>1850?(a.width=1152,a.height=710):t>=1600?(a.width=996,a.height=615):t>=1400?(a.width=856,a.height=528):(a.width=726,a.height=448);var s=new v(document.querySelector("#tui-image-editor"),{includeUI:{loadImage:{path:i.default,name:"SampleImage"},theme:p,initMenu:"filter",menuBarPosition:"bottom"},cssMaxWidth:a.width,cssMaxHeight:a.height,selectionStyle:{cornerSize:20,rotatingPointOffset:70}});this.imageEditor=s;var n=this,o=document.querySelector("#tui-image-editor"),r=this.$refs.playArea;this.playAreaWidth=r.offsetWidth-44,window.onresize=function(){var t=window.innerWidth,a=s._graphics.cssMaxWidth;t>1850?(e.playAreaWidth=1152,1152!==a&&s.resizeCanvasDimension({width:1152,height:710})):t>=1600?(e.playAreaWidth=996,996!==a&&s.resizeCanvasDimension({width:996,height:615})):t>=1400?(e.playAreaWidth=856,856!==a&&s.resizeCanvasDimension({width:856,height:528})):(e.playAreaWidth=726,726!==a&&s.resizeCanvasDimension({width:726,height:448}))},s.on("textEditing",(function(){var e=s.activeObjectId;document.onkeyup=function(){if(s.activeObjectId){var t={type:"editingText",text:s._graphics._objects[e].text,id:e};n.sendDrawData(t)}},o.onmousedown=function(){s.activeObjectId||(document.onkeyup=null,o.onmousedown=null)}})),s.on("mousedown",(function(e){var t=s.getCanvasSize(),a={type:"mousedown",e:{screenX:e.screenX,screenY:e.screenY,clientX:e.layerX,clientY:e.layerY,canvasWidth:t.width}};n.drawByShape(),n.sendDrawData(a),o.onmousemove=function(e){var t={type:"mousemove",e:{screenX:e.screenX,screenY:e.screenY,clientX:e.layerX,clientY:e.layerY}};n.sendDrawData(t)},document.onmouseup=function(e){var t={type:"mouseup",e:{screenX:e.screenX,screenY:e.screenY,clientX:e.layerX,clientY:e.layerY}};n.sendDrawData(t),o.onmousemove=null,document.onmouseup=null}}))},drawByShape:function(){var e=this.shape;"LINE_DRAWING"===e?this.drawLine():"FREE_DRAWING"===e?this.drawCurve():"SHAPE"===e?this.drawShape():"TEXT"===e&&this.addText()},drawLine:function(){this.imageEditor.startDrawingMode("LINE_DRAWING",{width:this.strokeWidth,color:this.strokeColor})},drawCurve:function(){this.imageEditor.startDrawingMode("FREE_DRAWING",{width:this.strokeWidth,color:this.strokeColor})},drawShape:function(){var e=this.imageEditor;e.setDrawingShape(this.drawingShape,{fill:this.fill?this.strokeColor:"transparent",stroke:this.strokeColor,strokeWidth:this.strokeWidth}),e.startDrawingMode("SHAPE")},addText:function(){var e=this.imageEditor;e.ui.text.fontSize=2*this.strokeWidth,e.ui.text._els.textColorpicker.color=this.strokeColor,e.startDrawingMode("TEXT")},eraser:function(){var e=this.imageEditor,t=e.activeObjectId;"NORMAL"!==this.shape&&this.stopDrawing(),e.removeActiveObject();var a={type:"ERASER",id:t};this.sendDrawData(a)},stopDrawing:function(){var e=this.imageEditor;e.stopDrawingMode(),this.shape="NORMAL",e.changeCursor("default");this.sendDrawData({type:"stopDrawing"})},clearAll:function(){this.imageEditor.clearObjects();this.sendDrawData({type:"CLEARALL"})},undo:function(){this.imageEditor.undo().catch((function(){}));this.sendDrawData({type:"UNDO"})},trigger:function(e){var t={type:e};"SHAPE"===e&&(0,s.default)(t,{drawingShape:this.drawingShape}),this.sendDrawData(t)},sendDrawData:function(e){(0,s.default)(e,{id:this.studentId}),this.rtcRoom.sendMessage(e,this.teacherId)},videoEnded:function(e){e.target.currentTime=0},changeAnimate:function(e){var t=this.coursewareResource[this.resourceIndex],a=t.type,s=t.url,i=this.$store.state.resourceUrl;1===a?(this.mode=e?this.mode:"video",this.$nextTick((function(){var e=this.$refs["video-play"];e.src=i+"/"+s,e.pause()}))):2===a&&(this.mode=e?this.mode:"animate",this.iframeSrc=i+"/"+s+"&roomId="+this.roomId+"&peerId="+this.studentId,this.wrapperZIndex=0)},getDrawData:function(){var e=this,t=document.querySelector(".upper-canvas"),a=document.querySelector("#tui-image-editor"),s=this.$refs["video-play"],i=this.$refs.playArea,n=document.createEvent("MouseEvents");this.rtcRoom.on("message-receive",(function(o){var r=o.type,d=o.e,c="",u="",l=1;if(d&&(c=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0,u=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,l=a.offsetWidth/o.canvasWidth),"setStrokeWidth"===r)e.strokeWidth=o.strokeWidth;else if("setStrokeColor"===r)e.strokeColor=o.strokeColor;else if("setFill"===r)e.fill=o.fill;else if("FREE_DRAWING"===r)e.shape="FREE_DRAWING",e.drawByShape();else if("SHAPE"===r)e.shape="SHAPE",e.drawingShape=o.drawingShape,e.drawByShape();else if("TEXT"===r)e.shape="TEXT",e.drawByShape();else if("editingText"===r){var h=o.text;if(!h)return;e.imageEditor.changeText(o.id,h)}else if("ERASER"===r)e.eraser();else if("CLEARALL"===r)e.clearAll();else if("UNDO"===r)e.undo();else if("NORMAL"===r)e.shape="NORMAL";else if("stopDrawing"===r)e.stopDrawing();else if("mousedown"===r)n.initMouseEvent("mousedown",!0,!0,document.defaultView,0,d.screenX,d.screenY,d.clientX*l+i.offsetLeft+22-c,d.clientY*l+i.offsetTop+22-u,!1,!1,!1,!1,0,null),t.dispatchEvent(n),e.drawByShape();else if("mousemove"===r)n.initMouseEvent("mousemove",!0,!0,document.defaultView,0,d.screenX,d.screenY,d.clientX*l+i.offsetLeft+22-c,d.clientY*l+i.offsetTop+22-u,!1,!1,!1,!1,0,null),t.dispatchEvent(n);else if("mouseup"===r)n.initMouseEvent("mouseup",!0,!0,document.defaultView,0,d.screenX,d.screenY,d.clientX*l+i.offsetLeft+22-c,d.clientY*l+i.offsetTop+22-u,!1,!1,!1,!1,0,null),t.dispatchEvent(n),e.imageEditor.stopDrawingMode(),e.drawByShape(),a.onmousemove=null;else if("pictureCovered"===r)e.showPicture=!0;else if("cancelPictureCovered"===r)e.showPicture=!1;else if("controlStudentOperate"===o.type){var v=o.data.peerId;v===e.studentId||"all"===v?e.controlStudentOperate=!0:(e.controlStudentOperate=!1,e.wrapperZIndex=99)}else if("changeMode"===r)e.mode=o.mode;else if("onStage-small"===r){var p=o.id,f=o.name;if(e.studentOutStage(p),e.studentOnStage=!0,p===e.studentId)document.querySelector(".video-students #video"+p).classList.add("onStage");else e.otherStudentOnStage=!0,e.studentOnStageId=p,e.studentOnStageName=f}else if("onStage-big"===r){var m=o.id,g=o.name;e.studentOutStage(m),e.studentOnStage=!1,e.studentOnStageTypeIsBig=!0;window.innerWidth;var S=e.playAreaWidth,w=S/1.622/.75;if(m===e.studentId){var _=document.querySelector(".video-students #video"+m),I=_.offsetWidth,y=_.offsetHeight;_.classList.add("onStage-big"),_.style.transform="translate("+(I+72+(S-w)/2)+"px,\n                        "+(-y-78)+"px)"}else{var C=document.querySelector(".student-on-stage-box .video-area"),k=document.querySelector(".video-students .video-area").offsetWidth;C.classList.add("onStage-big"),C.style.transform="translate("+(k+72+(S-w)/2)+"px,\n                        22px)"}m!==e.studentId&&(e.otherStudentOnStage=!0,e.studentOnStageId=m,e.studentOnStageName=g)}else if("outStage"===r){var E=o.id;e.studentOutStage(E)}else if("init"===r)e.synchronize(e.studentId);else if("control_video_play"===r){o.isplay?s.play():s.pause()}else if("control_video_progress"===r){var O=o.progress;s.currentTime=O*s.duration,s.paused&&s.play()}else"animate_page_change"===r&&(e.resourceIndex=o.page,e.changeAnimate())}))},studentOutStage:function(e){if(this.studentOnStage=!1,this.studentOnStageTypeIsBig=!1,e===this.studentId){var t=document.querySelector(".video-students #video"+e);t.style.transform="translate(0, 0)",t.classList.remove("onStage","onStage-big")}else{var a=document.querySelector(".student-on-stage-box .video-area");a.style.transform="translate(0, 0)",a.classList.remove("onStage","onStage-big")}this.otherStudentOnStage=!1,this.studentOnStageId="",this.studentOnStageName=""},synchronize:function(e){var t={type:"synchronize",id:e,values:{strokeWidth:this.strokeWidth,strokeColor:this.strokeColor,fill:this.fill,shape:this.shape}};this.rtcRoom.sendMessage(t,this.teacherId)}}}},73:function(e,t,a){Object.defineProperty(t,"__esModule",{value:!0});var s=n(a(44)),i=n(a(35));function n(e){return e&&e.__esModule?e:{default:e}}t.default={name:"TeacherVideo",data:function(){return{mikeStatus:!0,identity:"others"}},props:["rtcRoom","teacherName","teacherId"],components:{NetStatus:s.default,MikeStatus:i.default},created:function(){},mounted:function(){this.getTeacherVideo()},methods:{getTeacherVideo:function(){var e=this,t=this.$refs.video;this.rtcRoom.on("media-receive",(function(a,s){if(a===e.teacherId)try{t.srcObject=s}catch(e){t.src=window.URL.createObjectURL(s)}}))}}}},74:function(e,t,a){Object.defineProperty(t,"__esModule",{value:!0});var s=n(a(44)),i=n(a(35));function n(e){return e&&e.__esModule?e:{default:e}}t.default={name:"StudentVideo",data:function(){return{mikeStatus:!0,identity:"self"}},props:["id","studentVideoScale","showStudentStatus","rtcRoom","studentName","mode","showPicture","stream"],components:{NetStatus:s.default,MikeStatus:i.default},created:function(){"others"===this.mode&&(this.identity="others")},mounted:function(){"others"===this.mode||this.video()},computed:{},watch:{stream:function(e){var t=this.$refs.video;try{t.srcObject=e}catch(a){t.src=window.URL.createObjectURL(e)}}},methods:{checkDevice:function(){var e=this,t=0,a=0,s=[];navigator.mediaDevices.enumerateDevices().then((function(i){i.forEach((function(e){s.push(e.kind),"videoinput"===e.kind&&t++,"audioinput"===e.kind&&a++})),0===t&&e.$message.error("未发现摄像头"),0===a&&e.$message.error("未发现麦克风")})).catch((function(e){}))},video:function(){if(navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,!navigator.getUserMedia)return this.$message.error("摄像头异常,建议使用高版本的谷歌浏览器");this.checkDevice(),navigator.getUserMedia({video:{width:300,height:225},audio:!1},this.onSuccess,this.onError)},onSuccess:function(e){var t=this.$refs.video;try{t.srcObject=e}catch(a){t.src=window.URL.createObjectURL(e)}},onError:function(e){console.log(e),this.$message.error("摄像头未授权， 请设置浏览器")},getVideoStream:function(){var e=this,t=io("http://localhost:3000"),a=0,s=[],i=!1;t.on("chat message",(function(t){var n=e.$refs.video,o=new Uint8Array(t).buffer,r=new Blob([o],{type:"video/mp4"});s.push(r),s.length>=2&&!i&&(i=!0,setInterval((function(){var e=window.URL.createObjectURL(s[a]);n.src=e,a++}),3e3))}))},getStudentVideo:function(){var e=this,t=this.$refs.video;this.rtcRoom.on("media-receive",(function(a,s){if(console.log("peerId"+a),a===e.id)try{t.srcObject=s}catch(e){t.src=window.URL.createObjectURL(s)}}))}}}},75:function(e,t,a){Object.defineProperty(t,"__esModule",{value:!0});var s,i=a(35),n=(s=i)&&s.__esModule?s:{default:s};t.default={name:"StudentInfo",data:function(){return{mikeStatus:!1}},props:["studentName","studentOnStageId","id"],components:{MikeStatus:n.default}}}}]);