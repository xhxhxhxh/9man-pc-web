(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{114:function(e,t,s){"use strict";s.d(t,"a",(function(){return a})),s.d(t,"b",(function(){return r}));var a=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"live-container"},[a("div",{ref:"moveStar",staticClass:"move-star"},[a("img",{staticClass:"star",attrs:{src:s(160),alt:""}})]),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.showAnimateStar,expression:"showAnimateStar"}],ref:"animateStar",staticClass:"animate-star"},[a("img",{staticClass:"star",attrs:{src:e.animateStarSrc,alt:""}})]),e._v(" "),a("div",{staticClass:"alert"},[e.alertVisible?a("a-alert",{attrs:{message:e.alertMessage,type:"success"}}):e._e()],1),e._v(" "),a("main",[a("div",{ref:"mainLeft",staticClass:"main-left"},[a("div",{directives:[{name:"show",rawName:"v-show",value:"game"===e.mode,expression:"mode === 'game'"}],staticClass:"courseware-area"},[a("iframe",{ref:"iframe",attrs:{src:e.iframeSrc,allow:"autoplay"}}),e._v(" "),a("iframe",{staticStyle:{display:"none"},attrs:{src:e.iframeSrcCache,allow:"autoplay"}})]),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:"video"===e.mode,expression:"mode === 'video'"}],ref:"video-area",staticClass:"video-area"},[a("video",{ref:"video-play",attrs:{src:"",preload:"auto"},on:{timeupdate:e.videoTimeupdate,ended:e.videoEnded}})]),e._v(" "),a("div",{ref:"drawArea",staticClass:"draw-area"},[a("div",{ref:"drawArea",class:{mouseStyle:"FREE_DRAWING"===e.shape},attrs:{id:"tui-image-editor"}})]),e._v(" "),a("div",{class:{"operate-area":!0,hidden:e.stageStatus.length>0},on:{mousemove:function(e){return e.stopPropagation()}}},[a("div",{class:{default:!0,active:"NORMAL"===e.shape},on:{click:function(t){return e.changeDrawStatus("NORMAL")}}},[a("icon-font",{attrs:{type:"iconuf00db"}})],1),e._v(" "),a("div",{staticClass:"pen",class:{default:!0,active:"FREE_DRAWING"===e.shape},on:{click:function(t){return e.changeDrawStatus("FREE_DRAWING")}}},[a("icon-font",{attrs:{type:"iconpen"}})],1),e._v(" "),a("div",{staticClass:"delete",class:{default:!0,active:"DELETE"===e.shape,drawObjectActive:e.drawObjectActive&&"DELETE"===e.shape},on:{click:function(t){return e.changeDrawStatus("DELETE")}}},[a("icon-font",{attrs:{type:"iconsystem-deleteb"}})],1),e._v(" "),a("div",{staticClass:"previous-page",on:{click:function(t){return e.changeAnimate(t,0)}}},[a("a-tooltip",{attrs:{placement:"right",visible:e.firstPageTip}},[a("template",{slot:"title"},[a("span",[e._v("已经是第一个课件了")])]),e._v(" "),a("a-icon",{attrs:{type:"step-backward"}})],2)],1),e._v(" "),a("div",{staticClass:"next-page",on:{click:function(t){return e.changeAnimate(t,2)}}},[a("a-tooltip",{attrs:{placement:"right",visible:e.lastPageTip}},[a("template",{slot:"title"},[a("span",[e._v("已经是最后一个课件了")])]),e._v(" "),a("a-icon",{attrs:{type:"step-backward"}})],2)],1)]),e._v(" "),a("transition",{attrs:{name:"play-area-slide"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:e.showPlayArea&&"video"===e.mode&&e.stageStatus.length<=0||e.showPlayAreaAlways,expression:"(showPlayArea && mode === 'video' && stageStatus.length <= 0) || showPlayAreaAlways"}],staticClass:"play-area",on:{mouseenter:function(t){e.showPlayAreaAlways=!0},mouseleave:function(t){e.showPlayAreaAlways=!1}}},[a("span",{ref:"play",staticClass:"play",on:{click:e.videoPlay}}),e._v(" "),a("a-slider",{ref:"slider",attrs:{id:"test"},on:{change:e.videoPause,afterChange:e.changeVideoProgress},model:{value:e.progressBar,callback:function(t){e.progressBar=t},expression:"progressBar"}})],1)])],1),e._v(" "),a("div",{staticClass:"main-right"},[a("div",{staticClass:"teacher-area"},[a("div",{staticClass:"classroom"},[a("button",{on:{click:e.leaveRoom}},[e._v("离开教室")]),e._v(" "),a("button",[e._v("开始上课")])]),e._v(" "),a("TeacherVideo",{attrs:{rtcRoom:e.rtcRoom,teacherName:e.teacherName,peerIdList:e.peerIdList,role:"teacher",stream:e.streamObj[e.teacherId],studentList:e.studentList},on:{setAlert:e.setAlert}})],1)]),e._v(" "),a("div",{staticClass:"main-bottom"},[a("div",{staticClass:"students-area"},e._l(e.studentList,(function(t){return a("StudentVideo",{key:t.uid,attrs:{id:t.uid,rtcRoom:e.rtcRoom,studentName:t.uname,stream:e.streamObj[t.uid],info:t,role:"teacher"},on:{award:e.award,setAlert:e.setAlert}})})),1),e._v(" "),e._m(0)])])])},r=[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"placeholder"},[t("img",{attrs:{src:s(161),alt:""}})])}];a._withStripped=!0},312:function(e,t){},402:function(e,t,s){"use strict";s.r(t);var a=s(70),r=s.n(a);for(var i in a)"default"!==i&&function(e){s.d(t,e,(function(){return a[e]}))}(i);var o=s(114),n=s(11),c=!1;var d=function(e){c||s(312)},l=Object(n.a)(r.a,o.a,o.b,!1,d,null,null);l.options.__file="src\\views\\live\\LiveForTeacher.vue",t.default=l.exports},70:function(e,t,s){Object.defineProperty(t,"__esModule",{value:!0});var a=f(s(50)),r=f(s(17)),i=f(s(102)),o=f(s(46)),n=f(s(47)),c=f(s(8));s(163);var d=f(s(12));s(130);var l=f(s(131)),u=f(s(132)),m=f(s(91)),h=f(s(146)),v=f(s(147));function f(e){return e&&e.__esModule?e:{default:e}}var p=s(313),g=c.default.createFromIconfontCN({scriptUrl:"//at.alicdn.com/t/font_1543360_6pq73ac4jna.js"}),w={"menu.normalIcon.path":"/svg/icon-d.svg","menu.activeIcon.path":"/svg/icon-b.svg","menu.disabledIcon.path":"/svg/icon-a.svg","menu.hoverIcon.path":"/svg/icon-c.svg","submenu.normalIcon.path":"/svg/icon-d.svg","submenu.activeIcon.path":"/svg/icon-b.svg"};t.default={name:"Live",data:function(){return{mode:"game",showPlayArea:!1,showPlayAreaAlways:!1,firstLoad:!0,showAnimateStar:!1,animateStarSrc:u.default,startStarAnimate:!1,alertVisible:!1,alertMessage:"",coursewareResource:[],gameListIndex:[],gameIndex:0,resourceIndex:0,iframeSrc:"",iframeSrcCache:"",progressBar:0,imageEditor:null,shape:"NORMAL",strokeWidth:6,strokeColor:"#ff0000",drawObjectActive:!1,drawParams:{},drawTimeout:null,lineIdObj:{},rtcRoom:null,peerIdList:[],teacherId:"",roomId:"",studentList:[],studentIdList:[],teacherName:"",className:"",streamObj:{},firstPageTip:!1,lastPageTip:!1}},components:{IconFont:g,TeacherVideo:h.default,StudentVideo:v.default},computed:{stageStatus:function(){return this.$store.state.liveBroadcast.stageStatusSortByStage}},watch:{stageStatus:function(e){var t=e.length;if(t>=1){this.changeDrawStatus("NORMAL");var s=this.$refs["video-play"],a=this.$refs.play;s.paused||(s.pause(),a.classList.remove("pause"),this.sendMediaData(0,!1))}if(1===t){var r=document.querySelector("#studentVideo"+e[0]),i=this.studentIdList.indexOf(e[0]);r.classList.add("oneStudentOnStage"),r.classList.remove("moreStudentOnStage"),r.style.left=(-513*i+113)/100+"rem",r.style.top="-8rem"}else t>1&&e.forEach((function(e){document.querySelector("#studentVideo"+e).classList.add("moreStudentOnStage")}));if(2===t){var o=document.querySelector("#studentVideo"+e[0]),n=document.querySelector("#studentVideo"+e[1]),c=this.studentIdList.indexOf(e[0]),d=this.studentIdList.indexOf(e[1]);o.style.left=(-513*c+115)/100+"rem",n.style.top=o.style.top="-6.04rem",n.style.left=(-513*d+635)/100+"rem"}if(3===t){var l=document.querySelector("#studentVideo"+e[0]),u=document.querySelector("#studentVideo"+e[1]),m=document.querySelector("#studentVideo"+e[2]),h=this.studentIdList.indexOf(e[0]),v=this.studentIdList.indexOf(e[1]),f=this.studentIdList.indexOf(e[2]);l.style.left=(-513*h+375)/100+"rem",l.style.top="-7.99rem",u.style.top=m.style.top="-4.09rem",u.style.left=(-513*v+115)/100+"rem",m.style.left=(-513*f+635)/100+"rem"}if(4===t){var p=document.querySelector("#studentVideo"+e[0]),g=document.querySelector("#studentVideo"+e[1]),w=document.querySelector("#studentVideo"+e[2]),y=document.querySelector("#studentVideo"+e[3]),I=this.studentIdList.indexOf(e[0]),_=this.studentIdList.indexOf(e[1]),S=this.studentIdList.indexOf(e[2]),A=this.studentIdList.indexOf(e[3]);p.style.left=(-513*I+115)/100+"rem",g.style.left=(-513*_+635)/100+"rem",w.style.left=(-513*S+115)/100+"rem",y.style.left=(-513*A+635)/100+"rem",p.style.top=g.style.top="-7.99rem",w.style.top=y.style.top="-4.09rem"}}},created:function(){this.init()},mounted:function(){this.controlPlayArea(),this.initDrawingBoard()},methods:{init:function(){var e=this;return(0,n.default)(o.default.mark((function t(){return o.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.$store.commit("readLiveBroadcastDataFromLocalStorage"),e.resize(),t.next=4,e.queryClassInfo();case 4:e.initRtcRoom(),e.recoverPage(),e.getCoursewareInfo(e.$route.params.coursewareId);case 7:case"end":return t.stop()}}),t,e)})))()},resize:function(){var e=this,t=window.innerWidth;document.documentElement.style.fontSize=t/2213*100+"px",this.strokeWidth=parseInt(t/2213*6),window.onresize=function(){var t=window.innerWidth;e.strokeWidth=parseInt(t/2213*6),document.documentElement.style.fontSize=t/2213*100+"px",e.imageEditor.resizeCanvasDimension({width:t/2213*1271,height:t/2213*783})}},controlPlayArea:function(){var e=this,t=this.$refs.mainLeft,s=null,a=null;t.onmouseenter=function(){e.showPlayArea=!0,a&&(clearInterval(a),a=null)},t.onmousemove=function(){e.showPlayArea=!0,s&&(clearInterval(s),s=null),s=setInterval((function(){e.showPlayArea=!1,clearInterval(s),s=null}),2e3)},t.onmouseleave=function(){a||(a=setInterval((function(){e.showPlayArea=!1,clearInterval(a),a=null}),1e3))}},initRtcRoom:function(){var e=this,t=m.default.getInstance(),s=this.$route.params.roomId,a=this.$route.params.teacherId,o={name:this.$route.params.name,headUrl:"",role:1};t.joinRoom("www.9mankid.com",3210,s,a,o),this.teacherId=a,this.roomId=s,this.$store.commit("setTeacherId",a),this.className=o.classname,t.on("user-joined",(function(s){console.log("用户进入："+s),e.$set(e.streamObj,s,null),s===a&&(t.getAllRoomUser().forEach((function(t){var s=t._peerId;s!==a&&e.peerIdList.push(s)})),t.requestRoomInfo("room_config",{manager:a})),e.peerIdList.includes(s)||s===a||e.peerIdList.push(s),e.$store.commit("setPeerIdList",e.peerIdList)})),t.on("user-peer-connected",(function(s){if(console.log("用户连接："+s),s!==a){t.requestRoomInfo("user_sort",{}),e.studentList.forEach((function(t,a){t.uid===s&&(e.$set(e.studentList[a],"joinRoom",!0),e.$set(e.studentList[a],"isconnect",!0))}));var r=e.$store.state.liveBroadcast.liveBroadcastData.audioStatus[s];r?1===r?t.openAudio(s):2===r&&t.closeAudio(s):(t.openAudio(s),e.$store.commit("setAudioStatus",{id:s,status:1})),e.synchronize(s)}})),t.on("user-leaved",(function(t){console.log("用户离开："+t,e.peerIdList.indexOf(t));var s=e.peerIdList.indexOf(t);if(t!==a&&e.studentList.forEach((function(s,a){s.uid===t&&e.$set(e.studentList[a],"isconnect",!1)})),-1!==s){var r=e.$store.state.liveBroadcast.liveBroadcastData.allOperation,i=e.$store.getters.updateControlStatus[0];if(!r&&i===t){var o={event:"single_operations",data:{sync:{page:e.resourceIndex,type:0},peerId:""}};e.setAlert({visiable:!1,message:""}),e.rtcRoom.sendMessage(o),e.rtcRoom.changeAIControl(a)}e.peerIdList.splice(s,1),e.$store.commit("setPeerIdList",e.peerIdList),e.$store.commit("resetStatus",t),document.querySelector("#studentVideo"+t).style=""}})),t.on("media-receive",(function(t,s){e.$set(e.streamObj,t,s)})),t.on("room-info-notify",(function(t,s){var a=s.list,o=a.indexOf(e.teacherId);if(-1!==o&&a.splice(o,1),(0,i.default)(e.studentIdList)!==(0,i.default)(a)){e.studentIdList=a,e.$store.commit("setStudentIdList",a);var n={},c=[].concat((0,r.default)(e.studentList));a.forEach((function(e,t){n[e]=t}));for(var d=0;d<c.length;d++){var l=c[d].uid,u=n[l];if(void 0!==u&&u!==d){var m=[c[u],c[d]];c[d]=m[0],c[u]=m[1],u>d&&d--}}e.studentList=c}})),window.onbeforeunload=function(){t.leaveRoom()},this.rtcRoom=t,this.$store.commit("setRtcRoom",t)},recoverPage:function(){var e=this.$store.state.liveBroadcast.liveBroadcastData;this.resourceIndex=e.coursewarePage?e.coursewarePage:0},leaveRoom:function(){this.$confirm({title:"确定要退出房间吗?",content:"",centered:!0,onOk:function(){localStorage.removeItem("9manLiveBroadcast"),window.close()},onCancel:function(){}})},allUsersCancelOperate:function(){if(this.$store.state.liveBroadcast.liveBroadcastData.allOperation)this.$store.commit("setAllOperationStatus",!1);else if(this.$store.getters.updateControlStatus.length>0){var e={event:"single_operations",data:{sync:{page:this.resourceIndex,type:0},peerId:""}};this.setAlert({visiable:!1,message:""}),this.rtcRoom.sendMessage(e),this.rtcRoom.changeAIControl(this.teacherId)}this.$store.commit("updateStageStatusAll",!1)},synchronize:function(e){var t=this.$store.state.liveBroadcast.liveBroadcastData.allOperation,s=this.$store.getters.updateControlStatus,a={event:"live_sync",data:{from:"web",shape:"curve",hbColor:"#ff0000",hbLine:3,isSingleOperate:!!s.length,operateId:s.length?s[0]:"",isAllOperate:t,isAllVideo:!1,isSingleVideo:this.stageStatus.length>0,singleVideoArr:this.stageStatus,sync:{page:this.resourceIndex,type:0}}};this.rtcRoom.notifyMessage(a,e)},getCoursewareInfo:function(e){var t=this,s={courseware_no:e};this.$axios.get(this.$store.state.apiUrl+"/v1/courseware/queryCoursewareDetail",{params:s}).then((function(e){var s=e.data;if(200===s.code){t.coursewareResource=s.data.data.courseware_resource;var a=[];t.coursewareResource.forEach((function(e,t){2===e.type&&a.push(t)})),t.gameListIndex=a,t.changeAnimate(t.$event,1,t.firstLoad)}})).catch((function(){}))},queryClassInfo:function(){var e=this,t={id:this.$route.params.classId};return this.$axios.get(this.$store.state.apiUrl+"/v1/classRoom/queryClassRoomInfo",{params:t}).then((function(t){var s=t.data;if(200===s.code){var a=s.data.data.student_list,r=e.$store.state.liveBroadcast.liveBroadcastData.studentIdList;a.forEach((function(e){r.includes(e.uid)?e.joinRoom=!0:e.joinRoom=!1,e.isconnect=!1})),e.studentList=a,e.teacherName=s.data.data.teacher_name}})).catch((function(){}))},initDrawingBoard:function(){var e=this.$refs.mainLeft,t=e.offsetWidth,s=e.offsetHeight,r=new p(document.querySelector("#tui-image-editor"),{includeUI:{loadImage:{path:l.default,name:"SampleImage"},theme:w,initMenu:"filter",menuBarPosition:"bottom"},cssMaxWidth:t,cssMaxHeight:s,selectionStyle:{cornerSize:0,rotatingPointOffset:70,borderColor:"#000"}});this.imageEditor=r;var i=this,o=document.querySelector("#tui-image-editor");document.querySelector(".upper-canvas");r.on("objectActivated",(function(e){var t=e.id,s=[],a=i.lineIdObj[t];a?s.push(a):r._graphics._canvas._activeGroup._objects.forEach((function(e){s.push(i.lineIdObj[e.__fe_id])}));var o={event:"delete_line_choose_add",data:{lineIds:s}};i.rtcRoom.sendMessage(o)})),o.onmousedown=function(e){var t=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0,s=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,n=[e.clientX+t,e.clientY+s];if("FREE_DRAWING"===i.shape){var c=r._graphics._canvas._activeGroup,l=r._graphics._objects,u=(0,a.default)(l),m=(Array(7).join("0")+u.length).slice(-7),h=(0,d.default)().format("HHmmssSSS")+m;if(c){r._graphics._canvas.deactivateAll(),r._graphics._canvas.renderAll();i.rtcRoom.sendMessage({event:"delete_line_choose_cancel",data:{}})}i.drawParams={event:"add_line",data:{sync:{page:this.resourceIndex,type:0},lineId:h,shape:"curve",hbsize:[o.offsetWidth,o.offsetHeight],line:i.strokeWidth,color:i.strokeColor,pointlist:[n]}},i.drawByShape(),i.sendDrawData(),document.onmousemove=function(e){i.drawParams.data.pointlist.push([e.clientX+t,e.clientY+s]),i.sendDrawData()}}if("DELETE"===i.shape){var v={event:"select_line",data:{action:"mousedown",hbsize:[o.offsetWidth,o.offsetHeight],startPoint:n}};i.rtcRoom.sendMessage(v),document.onmousemove=function(e){var a={event:"select_line",data:{action:"mousemove",hbsize:[o.offsetWidth,o.offsetHeight],startPoint:[e.clientX+t,e.clientY+s]}};i.rtcRoom.sendMessage(a)}}document.onmouseup=function(e){if("FREE_DRAWING"===i.shape){var n=r._graphics._objects,c=(0,a.default)(n),d=parseInt(c[c.length-1]);r.setObjectProperties(d,{lockMovementX:!0,lockMovementY:!0,lockScalingX:!0,lockScalingY:!0,lockRotation:!0}),i.lineIdObj[d]=h,i.drawParams.data.pointlist.push([e.clientX+t,e.clientY+s]),i.drawParams.data.finished=!0,i.sendDrawData(),r.stopDrawingMode(),i.drawByShape(),document.onmousemove=null}if("DELETE"===i.shape){var l=r.activeObjectId;!l&&i.drawObjectActive?i.drawObjectActive=!1:l&&!i.drawObjectActive&&(i.drawObjectActive=!0);var u={event:"select_line",data:{action:"mouseup",hbsize:[o.offsetWidth,o.offsetHeight],startPoint:[e.clientX+t,e.clientY+s]}};i.rtcRoom.sendMessage(u),document.onmousemove=null}document.onmouseup=null}}},sendEventToIframe:function(){var e=this.$refs.wrapper,t=this.$refs.iframe,s=this;e.onmousedown=function(e){if("game"===s.mode){var a=t.contentWindow.document.querySelector("#gameCanvas"),r={screenX:e.screenX,screenY:e.screenY,clientX:e.layerX,clientY:e.layerY},i=document.createEvent("MouseEvents");i.initMouseEvent("mousedown",!0,!0,document.defaultView,0,r.screenX,r.screenY,r.clientX,r.clientY,!1,!1,!1,!1,0,null),a.dispatchEvent(i),document.onmousemove=function(e){var t={screenX:e.screenX,screenY:e.screenY,clientX:e.layerX,clientY:e.layerY};i.initMouseEvent("mousemove",!0,!0,document.defaultView,0,t.screenX,t.screenY,t.clientX,t.clientY,!1,!1,!1,!1,0,null),a.dispatchEvent(i)},document.onmouseup=function(e){var t={screenX:e.screenX,screenY:e.screenY,clientX:e.layerX,clientY:e.layerY};i.initMouseEvent("mouseup",!0,!0,document.defaultView,0,t.screenX,t.screenY,t.clientX,t.clientY,!1,!1,!1,!1,0,null),a.dispatchEvent(i),document.onmousemove=null,document.onmouseup=null}}}},drawByShape:function(){"FREE_DRAWING"===this.shape&&this.drawCurve()},drawCurve:function(){this.imageEditor.startDrawingMode("FREE_DRAWING",{width:this.strokeWidth,color:this.strokeColor})},stopDrawing:function(){var e=this.imageEditor;e.stopDrawingMode(),e.changeCursor("default")},eraser:function(){var e=this.imageEditor;e.activeObjectId;"NORMAL"!==this.shape&&this.stopDrawing(),e.removeActiveObject(),this.drawObjectActive=!1;this.rtcRoom.sendMessage({event:"delete_line",data:{source:"web"}})},clearAll:function(){var e=this.imageEditor;e.clearObjects(),this.drawObjectActive=!1,e._graphics._canvas.deactivateAll(),e._graphics._canvas.renderAll()},sendDrawData:function(){var e=this;this.drawTimeout||(this.drawTimeout=setInterval((function(){e.rtcRoom.sendMessage(e.drawParams),clearInterval(e.drawTimeout),e.drawTimeout=null}),100))},changeDrawStatus:function(e){this.shape=e;var t=this.$refs.drawArea;"FREE_DRAWING"===e?(t.style.pointerEvents="auto",this.drawByShape()):"NORMAL"===e?(t.style.pointerEvents="none",this.stopDrawing()):"DELETE"===e&&(t.style.pointerEvents="auto",this.eraser())},videoPlay:function(){if("video"===this.mode){var e=this.$refs["video-play"],t=this.$refs.play;e.paused?(e.play(),t.classList.add("pause"),this.sendMediaData(0,!0)):(e.pause(),t.classList.remove("pause"),this.sendMediaData(0,!1))}},videoTimeupdate:function(e){var t=e.target,s=t.currentTime;t.paused||(this.progressBar=parseInt(s/t.duration*100))},changeVideoProgress:function(e){var t=this.$refs.slider,s=this.$refs["video-play"],a=this.$refs.play;t.blur(),this.sendMediaData(0,!s.paused,e/100),a.classList.contains("pause")&&(s.play(),this.sendMediaData(0,!0)),s.currentTime=e/100*s.duration},videoPause:function(){var e=this.$refs["video-play"];e.paused||e.pause()},videoEnded:function(e){var t=e.target,s=this.$refs.play;t.currentTime=0,this.progressBar=0,s.classList.remove("pause")},sendMediaData:function(e,t,s){var a={};a=s||0===s?{event:"player_seek_to_value",data:{value:s,sync:{type:0,page:this.resourceIndex}}}:{event:"media_controll",data:{isplay:t,source:"fromweb",sync:{type:0,page:this.resourceIndex}}},this.rtcRoom.sendMessage(a)},setAlert:function(e){this.alertVisible=e.visiable,this.alertMessage=e.message},changeAnimate:function(e,t,s){var a=this;if(this.$store.state.liveBroadcast.liveBroadcastData.allOperation)return this.$message.warning("请先关闭全部授权",5);if(this.$store.getters.updateControlStatus)return this.$message.warning("请先关闭单人授权",5);this.changeDrawStatus("NORMAL");var r=this.coursewareResource.length-1,i=this.resourceIndex;if(2===t){if(i>=r&&!s)return this.lastPageTip=!0,void setTimeout((function(){a.lastPageTip=!1}),2e3);this.clearAll(),this.resourceIndex++}else if(0===t){if(i<=0&&!s)return this.firstPageTip=!0,void setTimeout((function(){a.firstPageTip=!1}),2e3);this.clearAll(),this.resourceIndex--}var o=this.coursewareResource[this.resourceIndex],n=o.type,c=o.url,d=this.$store.state.resourceUrl;this.gameCache();var l=this.$refs["video-play"];(l.pause(),1===n)?(this.$store.commit("setOperatePermission",!1),this.mode="video",l.src=d+"/"+c,this.$refs.play.classList.remove("pause"),this.progressBar=0):2===n&&(this.$store.commit("setOperatePermission",!0),this.mode="game",this.iframeSrc=d+"/"+c+"&roomId="+this.roomId+"&peerId="+this.teacherId+"&manager=1");this.sendMediaData("video"===this.mode?1:0,!1);var u={event:"show_content_change",data:{page:this.resourceIndex,type:0,sync:{page:this.resourceIndex,type:0}}};this.$store.commit("setCoursewarePage",this.resourceIndex),s||this.rtcRoom.sendMessage(u)},gameCache:function(){var e=this.$store.state.resourceUrl,t=this.resourceIndex,s=this.gameListIndex,a=this.gameIndex=this.searchInsert(s,t),r=s[a],i=s[a+1];r===t?i&&(this.iframeSrcCache=e+"/"+this.coursewareResource[i].url.replace("start","load")+"&roomId="+this.roomId+"&peerId="+this.teacherId+"&manager=1"):this.iframeSrcCache=e+"/"+this.coursewareResource[r].url.replace("start","load")+"&roomId="+this.roomId+"&peerId="+this.teacherId+"&manager=1"},searchInsert:function(e,t){var s=e.length-1,a=0;if(t>e[s])return 0;if(t<=e[a])return 0;for(;a<=s;){var r=Math.floor((a+s)/2);if(r===a)return a+1;if(t>e[r])a=r;else{if(!(t<e[r]))return r;s=r}}},award:function(e){var t={event:"award",data:{id:e}};this.rtcRoom.sendMessage(t)}}}}}]);